## **Урок 6: Встановлення та налаштування Cypress**

### **1. Зміст уроку**

#### **A. Вступ до встановлення Cypress**
- **Чому важливе встановлення:**
  - Перед написанням тестів Cypress необхідно правильно налаштувати середовище для забезпечення сумісності і стабільної роботи.
- **Необхідні умови для встановлення:**
  - Node.js встановлений на системі.
  - Базове розуміння пакетних менеджерів, таких як `npm` або `yarn`.


1. **Node.js встановлений:**
   - Cypress вимагає Node.js для управління встановленням і залежностями.
   - Встановити Node.js з офіційного сайту: [https://nodejs.org/](https://nodejs.org/).
   - Перевірити встановлення за допомогою:
     ```bash
     node -v
     npm -v
     ```

2. **Пакетний менеджер:**
   - Node.js містить `npm` (Node Package Manager) за замовчуванням. Також можна використовувати `yarn`, `pnpm` та інші.

3. **Ініціалізований JavaScript-проєкт:**
   - У вашому проєкті має бути файл `package.json`, який створюється через `npm init` або `yarn init`. Цей файл відстежує залежності, як Cypress, а також метадані проєкту.

4. **Базове розуміння командного рядка:**
   - Потрібно виконувати команди у терміналі для встановлення та запуску Cypress.

##### **Що таке npm і як він працює?**

**Що таке npm?**
- `npm` (Node Package Manager) — це інструмент, що постачається з Node.js та використовується для керування JavaScript-пакетами і залежностями.
- Він допомагає розробникам:
  - Встановлювати бібліотеки та інструменти.
  - Ділитися власними бібліотеками з спільнотою.
  - Керувати залежностями, специфічними для проєкту або глобальними.

**Як працює npm:**
1. **Встановлення пакетів:**
   - Встановити пакет локально (для поточного проєкту):
     ```bash
     npm install package-name
     ```
   - Встановити пакет глобально (доступний для всіх проєктів):
     ```bash
     npm install -g package-name
     ```

2. **Управління залежностями:**
   - Встановлені пакети зазначені у `package.json`, в секціях `dependencies` або `devDependencies`.

3. **Автоматизація скриптів:**
   - `npm` може запускати кастомні скрипти, визначені у `package.json`:
     ```json
     {
       "scripts": {
         "start": "node app.js",
         "test": "cypress open"
       }
     }
     ```
   - Запустити скрипт:
     ```bash
     npm run test
     ```

---

### **Різниця між npm, yarn, bun та pnpm**

| Характеристика         | **npm**              | **yarn**                   | **bun**                     | **pnpm**                         |
|-----------------------|----------------------|----------------------------|-----------------------------|----------------------------------|
| **Швидкість**         | Помірна              | Швидше за npm              | Найшвидший                  | Швидше за npm/yarn               |
| **Використання диску** | Високе (дублікати)   | Помірне                    | Ефективне                   | Низьке (жорсткі посилання для уникнення дублювання) |
| **Дерево залежностей** | Плоске               | Плоске                     | Плоске                      | Ієрархічне дерево (краща ізоляція) |
| **Офлайн режим**      | Обмежений            | Підтримується              | Підтримується               | Підтримується                    |
| **Поширеність**       | Дуже поширений       | Популярний у великих проєктах | Новий (що розвивається)     | Зростаюча популярність у підприємств |
| **Найкраще застосування** | Загальні випадки | Великі чи критичні до продуктивності проєкти | Швидка розробка         | Проєкти, які потребують ефективного зберігання     |


#### **B. Покроковий процес встановлення**
1. **Ініціалізуйте проєкт:**
   - Створіть нову папку для проєкту.
   - Запустіть `npm init` або `yarn init` для створення файлу `package.json`.
2. **Встановіть Cypress:**
   - Використайте команду `npm install cypress --save-dev` або `yarn add cypress --dev`.
3. **Перевірте встановлення:**
   - Запустіть `npx cypress open` або `yarn cypress open` для відкриття Cypress Test Runner.

##### **Що таке `npm init`?**

**Призначення:**
`npm init` ініціалізує новий Node.js-проєкт, створюючи файл `package.json`, який є конфігураційним файлом для керування залежностями та скриптами проєкту.

**Як це працює:**
1. Запустіть `npm init` у директорії проєкту:
   ```bash
   npm init
   ```
2. Відповідайте на запитання (назва проєкту, версія, опис тощо) або скористайтеся прапорцем `-y` для значень за замовчуванням:
   ```bash
   npm init -y
   ```
3. Файл `package.json` буде створено з наступними метаданими:
   ```json
   {
     "name": "my-project",
     "version": "1.0.0",
     "scripts": {},
     "dependencies": {},
     "devDependencies": {}
   }
   ```

#### **C. Огляд структури папок Cypress**
- **Типові директорії:**
  - `cypress/fixtures`: Зберігайте JSON-файли з тестовими даними.
  - `cypress/e2e`: Тут пишіть тестові файли.
  - `cypress/plugins`: Розширюйте функціонал Cypress.
  - `cypress/support`: Додавайте утиліти та глобальні налаштування.
- **Призначення кожної папки:**
  - **`fixtures`:** Централізоване місце для мок-даних (імітаційних даних) для тестів.
  - **`integration`:** Організація тестів за функціональністю чи ознакою.
  - **`support`:** Кастомні команди і глобальне налаштування Cypress.

##### **Призначення папок Cypress**

1. **`fixtures`:**
   - Зберігайте мок-дані у форматі JSON.
   - Використовується для імітації відповідей API або передачі тестових даних.
   - Приклад: `cypress/fixtures/users.json`
     ```json
     [
       { "id": 1, "name": "Alice", "role": "admin" },
       { "id": 2, "name": "Bob", "role": "user" }
     ]
     ```
   - Доступ у тестах:
     ```javascript
     cy.fixture('users').then((users) => {
       cy.log(users[0].name); // Виводить "Alice"
     });
     ```

2. **`e2e` (або `integration` у старих версіях):**
   - Зберігає власне тести, зазвичай організовані за фічами або функціональністю.
   - Приклад:
     ```
     cypress/integration/login.spec.js
     cypress/integration/dashboard.spec.js
     ```

3. **`plugins`:**
   - Розширює функціональність Cypress, наприклад, змінюючи поведінку браузера чи підключаючи плагіни.
   - Приклад:
     ```javascript
     module.exports = (on, config) => {
       // Модифікувати конфіг або встановити слухачі подій
     };
     ```

4. **`support`:**
   - Містить багаторазовий код, як-от кастомні команди чи глобальні налаштування.
   - Приклад: Додати кастомну команду логіну у `cypress/support/commands.js`:
     ```javascript
     Cypress.Commands.add('login', (username, password) => {
       cy.get('[data-testid="username"]').type(username);
       cy.get('[data-testid="password"]').type(password);
       cy.get('[data-testid="login-button"]').click();
     });
     ```

#### **D. Конфігураційні файли**
- **Огляд `cypress.config.js`:**
  - Налаштуйте базовий URL, розмір вікна, тайм-аути тощо.
  - Приклад:
    ```javascript
    const { defineConfig } = require('cypress');

    module.exports = defineConfig({
      e2e: {
        baseUrl: 'http://localhost:3000',
        viewportWidth: 1280,
        viewportHeight: 720,
        defaultCommandTimeout: 8000,
        supportFile: 'cypress/support/index.js',
      },
    });
    ```

##### **Що таке `baseUrl` у контексті Cypress?**

**Визначення:**
`baseUrl`— це конфігураційна властивість у `cypress.config.js`, яка задає базову адресу застосунку для тестування. Це спрощує тестовий код, оскільки не потрібно кожного разу вказувати повну URL у командах `cy.visit()`.

**Приклад:**
- У `cypress.config.js`:
  ```javascript
  module.exports = {
    e2e: {
      baseUrl: 'http://localhost:3000',
    },
  };
  ```
- Використання у тестах:
  ```javascript
  cy.visit('/login'); // Перетворюється на 'http://localhost:3000/login'
  ```

**Переваги:**
- Зменшує дублювання у тестових файлах.
- Полегшує оновлення, якщо базова адреса зміниться (наприклад, з `localhost` на стейджинг-сервер).

- **Встановлення змінних середовища:**
  - Використовуйте `env` у конфіг-файлі для секретних або багаторазових значень.
  - Приклад:
    ```javascript
    module.exports = defineConfig({
      env: {
        apiUrl: 'https://api.example.com',
      },
    });
    ```
  - Доступ у тестах через `Cypress.env('apiUrl')`.

### **Властивість `env` у `cypress.config.js`**

**Визначення:**
Властивість `env` у `cypress.config.js` зберігає змінні середовища, такі як API-ендпоінти, облікові дані чи прапорці режимів. Ці значення доступні у тестах через `Cypress.env()`.

**Приклад:**
- У `cypress.config.js`:
  ```javascript
  module.exports = {
    e2e: {
      env: {
        apiUrl: 'https://api.example.com',
        userRole: 'admin',
      },
    },
  };
  ```
- Використання у тестах:
  ```javascript
  describe('API Tests', () => {
    it('should fetch data from the API', () => {
      const apiUrl = Cypress.env('apiUrl');
      cy.request(`${apiUrl}/users`).then((response) => {
        expect(response.status).to.eq(200);
      });
    });
  });
  ```

**Переваги:**
- Централізує значення під певне середовище, що спрощує їх оновлення.
- Зберігає секретні дані (наприклад, API-ключі) поза тестовим кодом.

#### **E. Запуск тестів Cypress**
- **Open Mode (інтерактивний):**
  - Використайте `npx cypress open` для запуску Test Runner з графічним інтерфейсом.
- **Headless Mode (без інтерфейсу):**
  - Використайте `npx cypress run` для виконання тестів у терміналі.
  - Корисно для CI/CD.
- **Приклад команди:**
  ```bash
  npx cypress run --spec cypress/integration/login.spec.js
  ```

**`npx`** — це інструмент, який постачається з `npm` (починаючи з версії 5.2.0) і дозволяє виконувати Node.js-пакети напряму з командного рядка без глобального встановлення. Він дозволяє запускати двійкові файли пакетів, які встановлені локально у вашому проєкті, або завантажує їх із реєстру npm одноразово.

##### **Навіщо використовувати `npx`?**

1. **Тимчасове виконання:**
   - За допомогою `npx` можна запускати пакет тимчасово, не встановлюючи його постійно.
   - Наприклад:
     ```bash
     npx create-react-app my-app
     ```
     Це запускає пакет `create-react-app` без глобального встановлення.

2. **Уникнення глобальних установок:**
   - Замість глобального встановлення пакету (`npm install -g some-package`), `npx` одразу завантажує та виконує пакет.
   - Це зберігає чистоту середовища та уникає конфліктів версій.

3. **Запуск локально встановлених пакетів:**
   - Якщо пакет вже встановлений у вашому проєкті (`node_modules`), `npx` автоматично його запускає.
   - Приклад:
     ```bash
     npx cypress open
     ```
     Це запускає Cypress із вашої локальної папки `node_modules`, якщо він вже встановлений.

4. **Запуск певних версій пакету:**
   - Можна вказати точну версію для виконання:
     ```bash
     npx some-package@1.2.3
     ```

5. **Скелетони і генератори:**
   - `npx` часто використовується для запуску інструментів, які створюють нові проєкти або конфіг-файли без встановлення інструменту глобально.
   - Приклад:
     ```bash
     npx eslint --init
     ```

### **Як працює `npx`?**
- Коли ви запускаєте команду через `npx`:
  1. Він перевіряє, чи є пакет у локальних `node_modules`.
  2. Якщо його немає локально, тимчасово завантажує і запускає.
  3. Після виконання очищає тимчасові файли (якщо пакет був завантажений).

---

### **Коли використовувати `npx` і коли `npm`?**

| **Функція**             | **`npm`**                                 | **`npx`**                                    |
|-------------------------|-------------------------------------------|----------------------------------------------|
| **Встановлення**        | Встановлює пакет локально чи глобально.   | Запускає пакет без встановлення.             |
| **Використання**        | Потрібно спершу встановити пакет.         | Не потрібно встановлювати; запускає напряму. |
| **Глобальні пакети**    | Часто для управління глобальними інструментами.| Замінює потребу у глобальних установках. |
| **Одноразове використання** | Не підходить без встановлення.     | Ідеально для одноразових запусків.           |

---

### **Приклади використання `npx`**

1. **Запуск Cypress без глобального встановлення:**
   ```bash
   npx cypress open
   ```

2. **Генерація нового React-додатку:**
   ```bash
   npx create-react-app my-app
   ```

3. **Лінт файлів без глобального встановлення ESLint:**
   ```bash
   npx eslint myfile.js
   ```

4. **Запуск конкретних версій пакетів:**
   ```bash
   npx some-package@2.0.0
   ```

5. **Тимчасове виконання для тестування:**
   - Наприклад, `npx cowsay`:
     ```bash
     npx cowsay "Hello, World!"
     ```
`npx` — універсальний інструмент для спрощення запуску пакетів та уникнення захаращення системи зайвими глобальними установками, що ідеально підходить для розробників, які часто працюють з JavaScript-інструментами й фреймворками.

#### **F. Кращі практики налаштування**
- **Оновлюйте Cypress:**
  - Регулярно оновлюйте Cypress, щоб отримувати нові можливості та виправлення помилок.
- **Відстежуйте конфігураційні файли у системі контролю версій:**
  - Відстежуйте зміни `cypress.config.js` та інших файлів налаштування.
- **Створіть базову URL-адресу:**
  - Визначте baseUrl у конфіг-файлі для спрощення команд на кшталт `cy.visit()`.

---

### **2. Практичні вправи**

#### **A. Вправи з встановлення Cypress**
- **Мета:**
  - Покроково провести студентів через процес встановлення Cypress у своєму середовищі.
- **Кроки:**
  1. Встановіть Node.js, якщо ще не встановлений.
  2. Ініціалізуйте новий проєкт за допомогою `npm init`.
  3. Встановіть Cypress за допомогою `npm install cypress --save-dev`.
  4. Запустіть `npx cypress open` і дослідіть стандартну структуру папок.
- **Результат:**
  - Студенти мають побачити, що Cypress Test Runner успішно відкрився.

#### **B. Вправа з налаштування конфігураційного файлу**
- **Мета:**
  - Відредагувати `cypress.config.js`, додавши базову URL та параметри вікна.
- **Кроки:**
  1. Відкрийте `cypress.config.js`.
  2. Додайте наступне:
     ```javascript
     module.exports = {
       e2e: {
         baseUrl: 'http://localhost:3000',
         viewportWidth: 1366,
         viewportHeight: 768,
       },
     };
     ```
  3. Збережіть файл і знову запустіть `npx cypress open`.
- **Результат:**
  - Студенти мають змогу навігувати до baseUrl через `cy.visit('/')` у тестах.

---

### **3. Потенційні питання студентів**

1. **Що станеться, якщо Node.js не встановлено?**
   - **Відповідь:** Cypress вимагає встановленого Node.js, оскільки управляється через npm (Node Package Manager). Студентам потрібно скачати та встановити Node.js перед продовженням.

2. **Чи потрібно встановлювати Cypress глобально?**
   - **Відповідь:** Ні, Cypress зазвичай встановлюється локально у проєкті для кращого керування версіями і відтворюваності.

3. **У чому різниця між відкритим режимом (open mode) та headless mode Cypress?**
   - **Відповідь:** Відкритий режим запускає інтерактивний Cypress Test Runner і дозволяє бачити виконання тестів. Headless mode запускає тести у терміналі без UI — зручно для автоматизації.

4. **Навіщо використовувати базову URL-адресу у конфігурації?**
   - **Відповідь:** Це спрощує команди в тестах. Замість `cy.visit('http://localhost:3000/login')` можна писати `cy.visit('/login')`.

5. **Чи можна використовувати Cypress у вже існуючих проєктах?**
   - **Відповідь:** Так, Cypress можна додати до будь-якого JavaScript-проєкту, встановивши його як дев-залежність.

---

### **4. Додаткові матеріали**

#### **A. Офіційна документація:**
- [Інструкція з встановлення Cypress](https://docs.cypress.io/guides/getting-started/installing-cypress)
- [Конфігурація Cypress](https://docs.cypress.io/guides/references/configuration)

#### **B. Туторіали та статті:**
- [Структура папок та налаштування Cypress](https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests)
- [Гайд для початківців з встановлення Cypress](https://blog.testproject.io/2021/01/05/getting-started-with-cypress/)

#### **C. Відео:**
- **Traversy Media:** Cypress Crash Course
- **The Net Ninja:** Getting Started with Cypress Testing

#### **D. Практичні майданчики:**
- Встановіть Cypress для додатку TodoMVC чи онлайн-демо, наприклад, `http://todomvc.com`.

---

### **5. Пропонований розподіл уроку на 3 години**

#### **1 година: Вступ та встановлення (60 хвилин)**
- **Встановлення Cypress (30 хв):**
  - Покроково провести студентів через процес інсталяції.
  - Перевірити налаштування через `npx cypress open`.
- **Огляд структури папок (20 хв):**
  - Пояснити призначення кожної папки.
  - Де писати тести та зберігати мок-дані.
- **Q&A (10 хв):**
  - Відповіді на питання щодо інсталяції.

#### **2 година: Налаштування Cypress (60 хвилин)**
- **Створення та редагування `cypress.config.js` (30 хв):**
  - Налаштуйте baseUrl, розмір вікна, змінні середовища.
  - Розкрити важливість конфігураційних файлів.
- **Практична вправа (20 хв):**
  - Відредагувати файл конфігурації та перевірити зміни у Test Runner.
- **Q&A (10 хв):**
  - Уточнення по налаштуванню.

#### **3 година: Запуск тестів Cypress (60 хвилин)**
- **Режими open та headless (20 хв):**
  - Демо обох режимів та пояснення, коли який застосовувати.
- **Огляд прикладів тестів (30 хв):**
  - Запустити стандартні тести та показати вбудовані можливості Cypress.
  - Пояснити, як структурувати власні тести у папці `integration`.
- **Підсумок та Q&A (10 хв):**
  - Повторення кроків інсталяції та налаштування.
  - Остаточні питання та підготовка до наступного уроку.

---

### **6. Додаткові рекомендації**

#### **Інтерактивні демонстрації:**
- Покажіть, як вирішувати типові проблеми з встановленням (наприклад, права доступу, відсутність Node.js).
- Проведіть live-редагування `cypress.config.js` та продемонструйте одразу зміни.

#### **Заохочуйте участь:**
- Нехай студенти встановлюють Cypress самостійно і допомагають одне одному з налаштуванням.
- Дайте студентам експериментувати з налаштуванням параметрів (тайм-аути, розміри вікна).

#### **Надавайте чіткі вказівки:**
- Покрокові команди для встановлення і налаштування.
- Поради щодо організації папки `integration` для масштабованих тестів.

#### **Фокусуйтеся на практиці:**
- Використовуйте зрозумілі приклади, наприклад, налаштування baseUrl для тестового додатку.
- Пояснюйте, як правильне налаштування впливає на підтримуваність і масштабованість автоматизації тестування.