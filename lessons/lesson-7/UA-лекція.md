### **Урок 7: Взаємодія з веб-елементами та обробка користувацьких ввідних даних**

## **1. Зміст уроку**

### **A. Вступ**
- **Чому важлива взаємодія з веб-елементами:**
  - Перевіряє, як користувачі взаємодіють з елементами, такими як кнопки, поля вводу, чекбокси, випадаючі списки тощо.
  - Забезпечує, що веб-додатки поводяться так, як очікується, у відповідь на користувацькі дії.

##### Чому важлива взаємодія з веб-елементами

**Пояснення:**
- **Імітація реального використання:**  
  Взаємодія з веб-елементами імітує, як справжні користувачі користуються веб-додатком. Автоматизовані тести, які повторюють кліки, введення тексту та інші дії, допомагають впевнитися, що інтерфейс реагує належно у всіх сценаріях.

- **Перевірка поведінки UI:**  
  Це підтверджує, що дії користувача (як-от надсилання форми, вибір опції або виклик модального вікна) призводять до очікуваних змін у DOM, таких як відображення повідомлення про помилку, оновлення контенту чи навігація на нову сторінку.

- **Виявлення регресій:**  
  Автоматизовані взаємодії можуть швидко виявити регресії у UI. Якщо розробник внесе зміни, що вплинуть на поведінку кнопки, тест на взаємодію одразу сповістить про проблему.

- **End-to-End тестування:**  
  Тестування взаємодії критично важливе для кінець-в-кінець (E2E) тестів, де перевіряється повний шлях користувача — від завантаження сторінки до виконання послідовності дій і фіксації результатів.

### **B. Вибір елементів у Cypress**
- **CSS-селектори (основна методика):**
  - Базові селектори: `.class`, `#id`, `tag`.
  - Складні селектори: `div > button`, `input[type="text"]`.
- **Використання атрибутів `data-*`:**
  - Краща практика для стабільних селекторів в автоматизації:
    ```javascript
    cy.get('[data-testid="login-button"]');
    ```
- **Методи проходження по DOM:**
  - Знаходження дочірніх елементів: `cy.get('div').find('button')`.
  - Навігація по DOM-структурі: `.parent()`, `.children()`, `.next()`, `.prev()`.
- **Кращі практики:**
  - Використовуйте атрибути `data-*` для стабільності тестів.
  - Уникайте "крихких" селекторів, таких як `nth-child`.

  ##### cy.get() vs cy.find()
  **Ключова різниця:**  
  Використовуйте `cy.get()` для пошуку по глобальному DOM. Використовуйте `cy.find()`, коли потрібно звузити пошук до елементів усередині конкретного контейнера чи контексту.

  **cy.get():**
  - **Використання:**  
    `cy.get()` використовується для вибору елементів з усього DOM за заданим селектором.
  - **Приклад:**
    ```javascript
    // Вибір елемента з атрибутом data-testid на всій сторінці
    cy.get('[data-testid="login-form"]');
    ```

  **cy.find():**
  - **Використання:**  
    `cy.find()` використовується для пошуку нащадків у попередньо вибраному елементі.
  - **Приклад:**
    ```javascript
    // Спершу вибрати батьківський елемент
    cy.get('[data-testid="login-form"]')
      // Потім знайти дочірній input в цій формі
      .find('[data-testid="username-input"]');
    ```

##### Чому атрибут `data-testid` кращий за селектор за ID чи КЛАСОМ

**Пояснення:**
- **Стабільність при змінах UI:**  
  `data-testid` атрибути призначені виключно для тестування. Вони, як правило, не залежать від змін стилів чи рефакторингу, на відміну від ID або class, які можуть мінятися згідно з дизайнерськими вимогами.

- **Відокремлення відповідальностей:**  
  Розділення тестових селекторів і структурно-стильових гарантує, що тести залишаються надійними і не ламаються при візуальних змінах.

- **Описовість та зрозумілість:**  
  Вони чітко показують, що атрибут використовується для тестування (наприклад, `data-testid="login-button"`), що робить тести зрозумілими й простішими в підтримці.

- **Уникнення конфліктів:**  
  ID і класи застосовують для стилізації і верстки, тому залежність від них може привести до конфліктів або неочікуваної поведінки у разі дублювання селекторів.

**Приклад:**
```html
<!-- Використання data-testid для тестування -->
<button data-testid="submit-button">Submit</button>
```
```javascript
// Тест на Cypress з data-testid
cy.get('[data-testid="submit-button"]').click();
```

---

### **C. Дії з веб-елементами**
1. **Клік по елементам:**
   - Використовуйте `cy.click()` для імітації кліків.
   - Приклад:
     ```javascript
     cy.get('[data-testid="submit-button"]').click();
     ```

2. **Введення тексту у поля вводу:**
   - Використовуйте `cy.type()` для імітації вводу з клавіатури.
   - Приклад:
     ```javascript
     cy.get('[data-testid="username-input"]').type('testUser');
     ```
    - **Імітація клавіатурних подій:**
      - Використовуйте `.type()` зі спецклавішами, наприклад, `{enter}`, `{backspace}`.
      - Приклад:
        ```javascript
        cy.get('[data-testid="search-input"]').type('Cypress{enter}');
        ```

3. **Очищення полів вводу:**
   - Використовуйте `.clear()`, щоб видалити вміст.
   - Приклад:
     ```javascript
     cy.get('[data-testid="username-input"]').clear();
     ```

4. **Вибір опцій у випадаючому списку:**
   - Використовуйте `.select()` для елементів `<select>`.
   - Приклад:
     ```javascript
     cy.get('[data-testid="dropdown"]').select('Option 1');
     ```

5. **Чекбокси та радіо-кнопки:**
   - `.check()` для вибору, `.uncheck()` для зняття вибору чекбоксів.
   - Приклад:
     ```javascript
     cy.get('[data-testid="accept-terms"]').check();
     ```

6. **Надсилання форм:**
   - Використовуйте `.submit()` для імітації надсилання форми.
   - Приклад:
     ```javascript
     cy.get('[data-testid="login-form"]').submit();
     ```

7. **Наведення курсору на елементи:**
   - Cypress не має окремої дії наведення; використовуйте `.trigger('mouseover')`.
   - Приклад:
     ```javascript
     cy.get('[data-testid="menu-item"]').trigger('mouseover');
     ```
---

### **D. Валідація взаємодій**
- **Асерти (assertions):**
  - Підтверджують, що дії призвели до очікуваного стану або поведінки.
  - Приклад:
    ```javascript
    cy.get('[data-testid="success-message"]')
      .should('be.visible')
      .and('contain', 'Login Successful!');
    ```
- **Ланцюжок команд (chaining):**
  - Поєднуйте дії й перевірки для зрозумілих та коротких тестів.
  - Приклад:
    ```javascript
    cy.get('[data-testid="submit-button"]')
      .click()
      .get('[data-testid="error-message"]')
      .should('be.visible')
      .and('contain', 'Invalid credentials');
    ```

---

### **E. Розширена робота з ввідними даними**
- **Завантаження файлів:**
  - Використовуйте `cy.selectFile()` для елементів введення файлів.
  - Приклад:
    ```javascript
    cy.get('[data-testid="file-upload"]').selectFile('cypress/fixtures/sample.pdf');
    ```

- **Взаємодія з неактивними елементами:**
  - Перевіряйте або викликайте події на вимкнених елементах:
    ```javascript
    cy.get('[data-testid="submit-button"]').should('be.disabled');
    ```

##### cy.trigger()

**Пояснення:**
- **Призначення:**  
  `cy.trigger()` використовується для імітації подій, для яких немає спеціальної команди у Cypress (наприклад, `mouseover`, `keydown` тощо). Це корисно для тестування реакції елементів на складні або кастомізовані взаємодії.

- **Приклад:**
  ```javascript
  // Виклик події mouseover на елементі
  cy.get('[data-testid="menu-item"]').trigger('mouseover');
  ```

- **Коли використовувати:**  
  Використовуйте `cy.trigger()`, щоб імітувати події, що виходять за межі стандартних клік чи введення — особливо корисно для динамічних змін інтерфейсу, наприклад, підказок або меню, які з’являються при наведені.

##### cy.within()

**Пояснення:**
- **Призначення:**  
  `cy.within()` обмежує наступні команди Cypress певним елементом. Це корисно, коли потрібно звузити область пошуку до конкретного контейнера, щоби селектори шукали лише в межах цього контейнера.

- **Приклад:**
  ```javascript
  // Обмежити всі наступні команди формою
  cy.get('[data-testid="login-form"]').within(() => {
    cy.get('[data-testid="username-input"]').type('testUser');
    cy.get('[data-testid="password-input"]').type('password123');
  });
  ```

- **Переваги:**  
  - Підвищує надійність тесту, уникаючи хибних спрацювань через подібні елементи на сторінці.
  - Спрощує селектори шляхом звуження області пошуку.

##### Чому використовувати плагін Cypress Real Events (`cypress-real-events`) замість стандартних подій Cypress

**Пояснення:**
- **Обмеження нативних подій:**  
  Вбудовані команди Cypress (`cy.click()`, `cy.type()`) добре працюють для багатьох інтеракцій, але іноді не повністю імітують поведінку реального користувача. Наприклад, складні рухи миші чи послідовності подій можуть не викликатися так, як у справжньому браузері.

- **Плагін Cypress Real Events:**
  - **Мета:**  
    Плагін `cypress-real-events` надсилає реальні події браузера (наприклад, справжні рухи миші чи події клавіш), які більш адекватно імітують поведінку користувача.
  - **Переваги:**  
    - **Точніше імітує події:** Краще повторює поведінку подій, особливо для складних інтеракцій, ніж просто клік.
    - **Підвищує надійність тестів:** Корисно там, де стандартні події Cypress не викликають певні обробники подій, наприклад, для drag-and-drop або наведення.
  - **Приклад:**
    ```javascript
    // Спершу встановіть плагін:
    // npm install cypress-real-events --save-dev

    // У файлі підтримки Cypress (наприклад, cypress/support/commands.js) імпортуйте плагін:
    import 'cypress-real-events/support';

    // Далі використовуйте в тесті:
    cy.get('[data-testid="drag-item"]').realMouseDown();
    cy.get('[data-testid="drop-zone"]').realMouseUp();
    ```

- **Коли використовувати:**  
  Використовуйте плагін real events, коли потрібно імітувати послідовність подій, що максимально повторюють дії користувача — наприклад, drag-and-drop, ефекти наведення з затримкою або складні сценарії руху миші.

---

## **2. Практичні завдання**

### **A. Вправa 1: Надсилання форми**
- **Мета:**
  - Створити форму входу з атрибутами `data-testid`.
  - Імітувати дії користувача (логін, пароль), натиснути кнопку входу й перевірити повідомлення про успіх чи помилку.
- **Пропозиція щодо функціоналу:**
  - Проста форма входу з валідацією.

### **B. Вправа 2: Взаємодія з випадаючим списком і чекбоксом**
- **Мета:**
  - Додати випадаючий список для вибору ролі користувача та чекбокс для згоди з умовами.
  - Перевірити, що форма надсилається лише якщо всі поля заповнені і чекбокс відзначено.
- **Пропозиція щодо функціоналу:**
  - Форма, що не дозволяє відправлення до проходження валідації.

### **C. Вправа 3: Імітація клавіатурних подій**
- **Мета:**
  - Створити рядок пошуку, що фільтрує результати динамічно з набором тексту користувачем.
  - Протестувати поведінку функції пошуку за допомогою `.type()` й `.clear()`.
- **Пропозиція щодо функціоналу:**
  - Пошук у реальному часі, що відображає результати, які відповідають запиту.

---

## **3. Можливі питання студентів**

1. **Чому слід використовувати атрибути `data-*` замість CSS-селекторів?**
   - **Відповідь:** CSS-селектори можуть змінюватися при оновленнях дизайну, у той час як атрибути `data-*` стабільні й призначені для розробників/тестування, забезпечуючи надійність тест-сценаріїв.

2. **Як імітувати наведення курсору на елемент у Cypress?**
   - **Відповідь:** Використовуйте `.trigger('mouseover')`, оскільки у Cypress немає окремої дії наведення.

3. **Чи можу я взаємодіяти з прихованими або вимкненими елементами?**
   - **Відповідь:** За замовчуванням Cypress не дозволяє взаємодію з прихованими чи вимкненими елементами, але ви можете використати `.invoke('show')` або змінити атрибути для імітації дій.

4. **Як перевірити, що форма працює правильно?**
   - **Відповідь:** Поєднуйте дії (наприклад, введення, клік) з асертами для підтвердження очікуваних результатів, таких як виведення повідомлень про успіх чи помилку.

---

## **4. Додаткові матеріали**

- **Офіційна документація:**
  - [Cypress Commands](https://docs.cypress.io/api/commands)
  - [Cypress Best Practices](https://docs.cypress.io/guides/references/best-practices)

- **Відео та навчальні матеріали:**
  - [Traversy Media: Cypress Crash Course](https://www.youtube.com/watch?v=pk4z4k8I8fU)
  - [The Net Ninja: Cypress Testing Tutorials](https://www.youtube.com/watch?v=zLtqULPDuE8)

- **Інтерактивні інструменти:**
  - Практикуйтесь з такими інструментами, як [TodoMVC](http://todomvc.com).

- **Сайти для практики автоматизації тестування:**
  - [Advantage eshop demo](https://advantageonlineshopping.com)
  - [DemoBlaze eshop](https://www.demoblaze.com)
  - [Tools QA](https://demoqa.com)
  - [UI Test Automation Playground](http://uitestingplayground.com)
  - [Sauce Labs](https://www.saucedemo.com)
  - [Cypress Playground](https://cypress-playground.s3.eu-central-1.amazonaws.com/index.html)
  - [Automation Exercise](https://automationexercise.com)
  - [Practice Test Automation Website for Web UI & API](https://practice.expandtesting.com)

---

### Рекомендований розподіл уроку на 3 години

#### **1 година: Основи вибору і взаємодії з елементами (60 хвилин)**
- Знайомство з селекторами елементів.
- Виконання базових дій: кліки, введення.
- Практика: заповнення та відправлення форми.

#### **2 година: Розширені взаємодії і робота з даними вводу (60 хвилин)**
- Робота з дропдаунами, чекбоксами та завантаженням файлів.
- Імітація клавіатурних подій та робота з вимкненими елементами.
- Практика: взаємодія з динамічними дропдаунами та рядком пошуку.

#### **3 година: Валідація дій користувача (60 хвилин)**
- Написання асертів для різних сценаріїв.
- Поєднання дій і асертів у тест-кейсах.
- Практика: тестування та валідація поведінки форми залежно від ввідних даних.